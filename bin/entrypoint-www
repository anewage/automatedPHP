#!/bin/sh

# Generate ssh key
if [ ! -f /var/www/.ssh/id_rsa.pub ] ; then
 echo -e "\n\n\n" | ssh-keygen -t rsa -N "" -f /var/www/.ssh/id_rsa -q
 echo ----------------------------------------
 echo Your SSH Key is Ready
 echo ----------------------------------------
 cat /var/www/.ssh/id_rsa.pub
 echo ----------------------------------------
fi

# Check if data is not initialized yet
if [ ! -d /var/www/laravel ] ; then
	
	# Clone project
	if [ $# -ne 1 ]; then
		echo "illegal number of parameters, please specify git repo url"
		exit
	fi
	yes yes| GIT_SSH_COMMAND='ssh -o StrictHostKeyChecking=no' git clone --recursive $1 /var/www/laravel || exit

fi	

# Webhook
mkdir -p /var/www/laravel/public && \
ln -fs /webhook.php /var/www/laravel/public

# Remove lock file
if [ -f /var/www/laravel/.laas.lock ] ; then
	rm /var/www/laravel/.laas.lock
fi

# Update repo
/update
