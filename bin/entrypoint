#!/bin/bash

# Fix Permissions
mkdir -pv /var/www/logs /var/www/tmp
chmod g+w -R /var/www
chmod 700 -R /var/www/.ssh 
chown -R www-data:www-data /var/www /root

# persist Environment
echo "$WEBHOOK_SECRET" > /WEBHOOK_SECRET
echo `env` > /env

if [ $# -eq 0 ] ; then
    # Start www-data entrypoint and fork
    sudo -E -u www-data -g www-data /entrypoint-www $@ &

    # Start supervisord
    /usr/bin/supervisord -c /etc/supervisord.conf 
else
    # Run user cmd
    /cmd $@
fi
