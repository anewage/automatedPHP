#!/bin/bash
SCRIPT=`realpath $0`
DIR=`dirname $SCRIPT`

# Parse Arguments
OPTIND=1
COMMON_NAME=""
DOMAINS=""
SOCKETPATH=""
SSL_CONF=""

while getopts "?h:su:" opt; do
	case "$opt" in
		h)
			COMMON_NAME=$OPTARG
			;;
		s)
			SSL_CONF="`cat ssl.conf`"
			;;
		u)
			SOCKETPATH=$OPTARG
			;;
		*)
			echo "Usage: $0` -h [common name] -u [socket path] {domains list}"
			exit
			;;
	esac
done  	

shift "$((OPTIND-1))"
DOMAINS=`printf $@`


# Generate Nginx Configuration File

# render a template configuration file
# expand variables + preserve formatting
# http://pempek.net/articles/2013/07/08/bash-sh-as-template-engine/
render_template() { eval "echo \"$(cat $1)\"" }

sudo render_template nginx.conf /etc/nginx/sites-enabled/$COMMON_NAME.conf

sudo nginx -s reload